---
title: "parse_ores"
author: "Anirudh"
date: "2022-10-10"
output: html_document
---

```{r setup}

library(dplyr)
library(tidyr)
library(stringr)
```

```{r}

ores<- read.csv("mineral-ores.csv")

ores <- ores %>%
  filter(country == "United States")

ores <- ores %>%
  filter(com_type == "M")

ores <-ores %>%
  mutate(commod1 = strsplit(as.character(commod1),",")) %>%
  unnest(commod1)


ores <- ores %>%
  mutate(state = strsplit(as.character(state),",")) %>%
  unnest(state)

ores <- ores %>%
  mutate(state = str_trim(state))

ores <- ores %>%
  mutate(commod1 = str_trim(commod1)) %>%
  filter(commod1 != "Construction")



```

```{r}
state_id <- read.csv("state_id.csv")

```

```{r ores_bystate}

by_province <- ores %>%
  group_by(state,commod1) %>%
  count()




state_max <- by_province %>%
  group_by(state)%>%
  filter(n == max(n))

state_max <- merge(state_max,state_id,by = "state")

state_max <- state_max[,1:4]


```

```{r}
state_max %>%
  group_by(state)

```



```{r}

write.csv(by_province,"province_bar.csv")
write.csv(state_max,"top_metal.csv")

write.csv(ores[,c(1,2,3,6,7,9,16)],"ores_short.csv")
```

```{r}
dir.create(temp <- tempfile())
ores %>%
  group_by(state) %>%
  group_walk(~ write.csv(.x, paste0("state_deposits/",.y$state, ".csv")))
list.files(temp, pattern = "csv$")

```




